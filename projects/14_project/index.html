<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Ball on Plate with Hand Teleoperation | Jesús Ferrándiz</title> <meta name="author" content="Jesús Ferrándiz"> <meta name="description" content="Simple control project as a test bench to integrate different algorithms."> <meta name="keywords" content="robotics, software, computer-vision, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://jeferal.github.io/projects/14_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Jesús </span>Ferrándiz</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"></a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item "> <a class="nav-link" href="/experiences/">Experiences</a> </li> <li class="nav-item "> <a class="nav-link" href="/life/">Life</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Ball on Plate with Hand Teleoperation</h1> <p class="post-description">Simple control project as a test bench to integrate different algorithms.</p> </header> <article> <p>This is a personal project I have been working with for a few weeks. It consists on controlling the position of a ball on a platform using the feedback of a camera. This is the hardware that is used:</p> <ul> <li>2DOF Platform with Servo Motors</li> <li>Micro Controller ESP8266</li> <li>5V DC Power Supply</li> <li>Camera Realsense D415</li> <li>Computer with GPU</li> </ul> <p align="center"> <img width="500" height="400" src="/assets/img/ball_on_plate_hw.jpeg"> </p> <div class="caption"> Ball on plate Hardware. </div> <h2 id="interfacing-with-the-servo-motors">Interfacing with the Servo Motors</h2> <p>Writing the position commands to the servo motors with a PWM signal is done with the micro controller <code class="language-plaintext highlighter-rouge">ESP8266</code>. This micro controller has been programmed with the PlatformIO visual code extention, which is a very powerful IDE to easily create projects and program many different boards using many libraries. The code for the micro controller can be found in the <a href="https://github.com/jeferal/servo_platform_firmware" rel="external nofollow noopener" target="_blank">servo_platform_firmware</a>.</p> <p>This program checks the serial port of the board and looks for position commands that are sent to the servos. Finally, it will send back to the serial port the current position of the servos and how much time it has taken to compute this.</p> <h2 id="servo-platform-ros-driver">Servo Platform ROS Driver</h2> <p>This component uses a simple serial ROS-less class that can be found in the <a href="https://github.com/jeferal/servo_platform/tree/master/sp_driver" rel="external nofollow noopener" target="_blank">sp_driver</a> package. This class implements everything that is needed to send messages through the serial port. The communication protocol characteristics is set with a termios structure and it has the required parameters to ensure a non-blocking continuous communication with the micro controller.</p> <p>The SpROSDriver inherits from the SpDriver class (a class that contains the simple serial communication and methods to write roll, pitch commands and process the response) and it is implemented in the package <a href="https://github.com/jeferal/servo_platform/tree/master/sp_ros_driver" rel="external nofollow noopener" target="_blank">sp_ros_driver</a> package.</p> <p>There is also a quick script that uses pygame to send commands with the xbox controller <a href="https://github.com/jeferal/servo_platform/blob/master/sp_ros_driver/scripts/xbox_controller.py" rel="external nofollow noopener" target="_blank">here</a>. And another script that sends a sinusoidal position trajectory <a href="https://github.com/jeferal/servo_platform/blob/master/sp_ros_driver/scripts/sin_cos_example.py" rel="external nofollow noopener" target="_blank">here</a>.</p> <h2 id="ball-tracking-and-control">Ball tracking and control</h2> <p>Because of the material of the ball, it suffers from reflections and this makes the problem of tracking the ball more difficult. I started trying to implement a detector that uses classical computer vision techniques such as color segmentation or the hough transform to detect circles, but it is difficult to fine tune the parameters of this algorithms to make them robust against reflections and uncontrolled light conditions.</p> <p>After that, I experimented with the trackers that are implemented in the OpenCV library. They all use a common API so it is easy to change between them. The one I tried mostly was <code class="language-plaintext highlighter-rouge">CSRT</code>. However this tracker would eventually drift and the bounding box of the ball could be smaller or bigger than the truth. Another disadvantage is that the implementation of this tracker was using the CPU.</p> <p>For these reasons I decided to do some research and found out about the (DaSiamRPN)[https://arxiv.org/abs/1808.06048] tracker. This tracker is implemented in OpenCV 4.8 with support for Cuda and GPU acceleration. This is when I decided to create a docker image whose Dockerfile builds OpenCV from source with Cuda support. This image starts from an image with Ubuntu 20.04, Cuda 11.4.3 and Cudnn 8 The Dockerfile can be found <a href="https://github.com/jeferal/servo_platform_docker/blob/main/servo_platform_build/Dockerfile" rel="external nofollow noopener" target="_blank">here</a>. <a href="https://jeferal.github.io/projects/13_project/">This post</a> explains a little bit more about the build process and benchmark of algorithms using <a href="https://github.com/opencv/opencv_zoo" rel="external nofollow noopener" target="_blank">OpenCV Zoo</a>.</p> <p>This tracker was giving much better results and releasing the CPU from doing this.</p> <p>The implementation of the ball position control is based on a simple PID controller for the x and y axes. The implementation was quite stright forward.</p> <h2 id="hand-teleoperation">Hand teleoperation</h2> <p>Once the ball position control was implemented, I was looking for a nice way for a human to interact with the system. I decided that it would be nice to use the hand to control the ball position as if some one was grasping it. For this reason, I made use of the mediapipe model to get the landmarks of the hand, and then given the position of the first finger and thumb tips I created a quick script to “pinch grasp” and move it around. The output of the position of the pinch grasp is filtered to avoid sudden changes in the set point and make it look as a more natural movement.</p> <p>This is the control diagram:</p> <p align="center"> <img width="550" height="400" src="/assets/img/servo_platform_mediapipe_diagram_definitive.jpg"> </p> <div class="caption"> Control diagram with teleoperation control. </div> <h2 id="results">Results</h2> <p>The results can be seen in the following video:</p> <p align="center"> <iframe width="728" height="410" src="https://www.youtube.com/embed/X9RQbtMX3PQ?si=42gEcN67TXZgx2ke" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe> </p> <div class="caption"> Ball control and teleoperation results. </div> <h2 id="next-steps">Next steps</h2> <p>This is only the beginning and there are many algorithms that could be implemented. These are the next steps I have planned:</p> <ul> <li>Fill in the doxygen in the code.</li> <li>Implement a simulation to be able to train RL algorithms to control the ball position.</li> <li>Create a gym environment.</li> <li>Train and evaluate different RL algorithms.</li> <li>Deploy the software on a Jetson Nano and use its GPU.</li> <li>Use this platform to solve ball mazes.</li> </ul> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Jesús Ferrándiz. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>